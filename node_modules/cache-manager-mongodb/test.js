var cacheManager = require('cache-manager');
var mongoStore = require('./index.js');
const Logger = require('mongodb').Logger;

var mongoCache = cacheManager.caching({
  store: mongoStore,
  uri: "mongodb://192.168.1.39:27017/dev",
  options: {
    collection: "cacheManager",
    compression: false,
    poolSize: 5,
    auto_reconnect: true,
    ttl: 600
  }
});
// Set debug level
Logger.setLevel('info');

/*
mongoCache.set('foo', 'bar', 10 * 1000).then(() => {
  return mongoCache.get('foo');
}).then((result) => {
  console.log(result);
  // >> 'bar'
  //return mongoCache.del('foo');
});*/

// Note: ttl is optional in wrap()
/*return mongoCache.wrap('utente1', function (cb) {
  getUser('userId2', cb);
}, (err, user) => {
  console.log(user);
  mongoCache.wrap('utente1', (cb) => {
    getUser('userId2', cb);
  }, (err, user2) => {
    console.log(user2)
  })
})*/
mongoCache.set('test-cookie-1', 'test-user')
  .then(() => {
    return mongoCache.get('test-cookie-1')
  }).then((v) => {
    console.log(v);
  }).catch((err) => {
    console.log(err)
  });



function getUser(id, cb) {
  setTimeout(function () {
    console.log("Returning user from slow database.");
    cb(null, {
      id: id,
      name: 'Bob'
    });
  }, 1000)
};
